\section{Depth-zero Hecke algebras for principal series blocks}
    Let $\cR_{[M,\sigma]}(G)$ be a Bernstein block. If $M$ is the maximal torus $T$ (or a conjugate of $T$), then $\sigma=\tilde\chi$ is just a character and the $\cR_{[T,\tilde\chi]}(G)$ is called a principal series block. These are the ones we aim to understand.

    We remark that the block is completely determined the values of $\tilde\chi$ on $T(\cO)$, which has a natural filtration of open compact subgroups
    $$T(\cO)\supset T(1+\varpi\cO)\supset T(1+\varpi^2\cO)\supset T(1+\varpi^3\cO)\supset\cdots$$
    which forms a basis for the topology at the identity.
    This motivates the following definition:
    \begin{definition}
        The \textit{depth} of $\chi$ is the smallest integer $r$ such that $\chi$ is trivial on $T(1+\varpi^{r+1}\cO)$.
    \end{definition}
    In particular, if $\chi$ has depth-zero, then $\chi$ is trivial on $T(1+\varpi\cO)$ and therefore it factors through the quotient $T(\cO)\rightarrow T(k_F)$. We shall abuse notation and denote the resulting character $T(k_F)\rightarrow \CC^{\times}$ also as $\chi$. Fortunately, for such blocks, the construction of a type is completely explicit.

    Recall that the Iwahori subgroup $I$ of $G$ is defined as 
    $$I=\langle T(\mathcal{\mathcal{O}}); \mathfrak{X}_\alpha(\mathcal{O}),\mathfrak{X}_{-\alpha}(\varpi\mathcal{O})\ |\ \alpha\in\Phi^+\rangle$$
    with its pro-$p$ unipotent radical
    $$I^+=\langle T(1+\varpi\mathcal{\mathcal{O}}); \mathfrak{X}_\alpha(\mathcal{O}),\mathfrak{X}_{-\alpha}(\varpi\mathcal{O})\ |\ \alpha\in\Phi^+\rangle.$$

    We remark that in using the root subgroups of $G$, we have implicitly chosen a Chevalley basis of $\mathfrak{g}$, the Lie algebra of $G$.

    %Let $\mathcal{B}(G,F)$ be the building of $G$ and let $\mathcal{A}(G,T,F)=X_*(T)\otimes\RR\subseteq \mathcal{B}(G,F)$ be the apartment corresponding to $T$, which comes equipped with a hyperplane structure arising from the affine roots. Let 
    %$$I=\langle T(\mathcal{\mathcal{O}}); \mathfrak{X}_\alpha(\mathcal{O}),\mathfrak{X}_{-\alpha}(\varpi\mathcal{O})\ |\ \alpha\in\Phi^+\rangle$$
    %be the Iwahori subgroup of $G$, and let $\textbf{a} \subset\mathcal{A}(G,T,F)$ be the unique alcove such that $G_{x,0}=I$ (first element in the Moy--Prasad filtration) for all $x\in\bf a$.

    In particular, there is an isomorphism
    $$T(\cO)/T(\cO)\cap I^+\cong I/I^+$$
    and therefore $\chi$ determines a character $\rho_\chi$ of $I$ that is trivial on $I^+$. Explicitly, $I$ has an Iwahori decomposition $$I=(I\cap\bar U)\cdot T(\cO)\cdot(I\cap U),$$
    and $\rho_\chi$ extends $\chi$ in $T(\cO)$ and is trivial on $I\cap\bar U$ and $I\cap U$.

    \begin{theorem}
        Suppose that $\chi$ is a depth-zero character of $T(\cO)$. Then $(I,\rho_\chi)$ is a $[T,\tilde\chi]$-type, where $\tilde\chi$ is any extension of $\chi$ to $T(F)$.
    \end{theorem}

    This theorem motivates us to study the Hecke algebra $\cH(G,I,\rho_\chi)$, where $\rho_\chi$ is a character of $I$ arising from a depth-zero character of $T(\cO)$ as described above. 

    When $C=\CC$ has characteristic $0$, one can explicitly describe the structure of $\cH(G,I,\rho_{\chi})$ in terms of a few objects associated to $\chi$. To state the theorem, we first need some preliminaries. Firstly, we let $N:=N_G(T)$ be the normalizer of the torus, and we let $W=N(F)/T(F)$ and $\tilde{W}=N(F)/T(\cO)$ be the Weyl group and the extended Weyl group of $G$ respectively. The Weyl group is a coxeter group generated by a set of simple reflections $S=\{s_\alpha\ |\ \alpha\in\Pi\}$, where $\Pi\subset\Phi$ is any fixed integral basis. There is also a canonical isomorphism of abelian groups $X_*(T)=\Hom_F(\GG_m,T)\longrightarrow T(F)/T(\cO)$ given by $\lambda\mapsto\lambda(\varpi^{-1})$.
    
    There is a canonical surjective homomorphism $\tilde{W}\rightarrow W$ with kernel $X_*(T)$ and a non-canonical section. Therefore there is a non-canonical isomorphism $\tilde{W}=X_*(T)\rtimes W$. The extended Weyl group $\tilde{W}$ comes with an action on the apartment $\mathcal{A}=\mathcal{A}(G,T,F)=X_*(T)\otimes\RR$ that respects the hyperplane structure and therefore permutes the alcoves. The apartment is effectively a vector space over $\RR$ where the origin is the only point fixed by every $s_\alpha,\ \alpha\in\Phi$. The group $X_*(T)$ acts naturally by translations and $W$ is the group of transformations of $\tilde{W}$ fixing the origin. Inside the apartment, we distinguish the Weyl chamber and fundamental alcove of $\Phi$ which are, respectively,
    \begin{align*}
        \mathcal{C}&=\{v\in\mathcal{A}\ |\ 0<\langle\alpha,v\rangle,\forall\alpha\in\Phi^+\}\quad\text{and}\\
        \mathcal{D}_0&=\{v\in\mathcal{A}\ |\ 0<\langle\alpha,v\rangle<1,\forall\alpha\in\Phi^+\}.
    \end{align*}

    The extended Weyl group $\tilde{W}$ contains a subgroup $$W_{\aff}=\ZZ\vPhi\rtimes W=\langle s_a\ |\ a=\alpha+k,\alpha\in\Phi,k\in\ZZ \text{ is an affine root}\rangle,$$ denoted as the affine Weyl group, which acts simply transitively on the set of alcoves. In particular, $W_{\aff}$ is also a Coxeter group generated by the simple reflections $S_{\aff}=S\cup\{s_0\}$ where $s_0$ is the reflection along the hyperplane $P_{\alpha_0,1}=\{v\in\mathcal{A}\ |\ \langle\alpha_0,v\rangle=1\}$. These correspond to reflections along the walls of the fundamental alcove $\mathcal{D}_0$. It then follows that $\tilde{W}=W_{\aff}\rtimes\Omega$, where $\Omega=\mathrm{Stab}_{\tilde{W}}(\mathcal{D}_0)$. As coxeter groups, both $W$ and $W_{\aff}$ come equipped with a length function. Since $W$ is a parabolic subgroup of $W_{\aff}$, it follows that the length function of both groups coincide on elements of $W$. Moreover, one can extend the length function uniquely to $l:\tilde{W}\rightarrow\ZZ^{\geq0}$ in such a way that $\Omega=\{w\in\tilde{W}:l(w)=0\}$. In fact, one can prove that $l(w)$ equals the number of affine hyperplanes separating $\mathcal{D}_0$ to $w\cdot\mathcal{D}_0$.

    We now turn out attention to the character $\chi$ and define analogous associated groups
    \begin{align*}
        &N_{\chi}=\{n\in N(F)\ |\ \prescript{n}{}{\chi}=\chi\}\\
        &\tilde{W}_{\chi}=\{w\in \tilde{W}\ |\ \prescript{w}{}{\chi}=\chi\}\\
        &W_{\chi}=\{w\in W\ |\ \prescript{w}{}{\chi}=\chi\}
    \end{align*}
    with surjective group homomorphisms $N_\chi\rightarrow\tilde{W}_\chi\rightarrow W_\chi$. We remark that nor $\tilde{W}_\chi$ nor $W_\chi$ are coxeter groups in general, and therefore are not Weyl groups of subroot systems of $\Phi$. However, we may define $$\Phi_\chi=\{\alpha\in\Phi:\chi\circ\alpha^\vee|_{\cO^\times}=1\},$$ which is clearly a subroot system of $\Phi$. Naturally, we let $\vPhi_\chi=\{\valpha\ |\ \alpha\in\Phi_\chi\}$ and $\Phi_{\chi,\aff}=\{\alpha+k\ |\ \alpha\in\Phi_\chi,k\in\ZZ\}$ be the associated coroot system and affine root system to $\Phi_\chi$. 
    
    We also consider the Weyl group $W_\chi^\circ$, affine Weyl group $W_{\chi,\aff}$, Weyl chamber $\mathcal{C}_\chi$ and fundamental alcove $\mathcal{D}_{\chi,0}$ associated to $\Phi_\chi$. Explicitly,
    \begin{align*}
        W_\chi^\circ&=\langle s_\alpha\ |\ \alpha\in\Phi_\chi\rangle,\\
        W_{\chi,\textrm{aff}}&=\langle s_a \ |\  a\in\Phi_{\chi,\aff}\rangle,\\
        \mathcal{C}_\chi=\{v\in&\mathcal{A}(G,T,F)\ |\ 0<\alpha(v), \forall\alpha\in\Phi_\chi^+\},\\
        \mathcal{D}_{\chi,0}=\{v\in&\mathcal{A}(G,T,F)\ |\ 0<\alpha(v)<1, \forall\alpha\in\Phi_\chi^+\}.
    \end{align*}

    Analogously to the previous case, $W_\chi^\circ$ is a coxeter group generated by a set of simple reflections $S_\chi=\{s_\alpha:\alpha\in\Pi_\chi\}$ along the walls of the Weyl chamber $\mathcal{C}_\chi$, where $\Pi_\chi\subset\Phi_\chi$ is an integral basis. Similarly, $W_{\chi,\aff}$ is a coxeter group generated by a set of simple reflections $S_{\chi,\aff}=\{s_a:a\in\Pi_{\chi,\aff}\}$ along the walls of the fundamental alcove $\mathcal{D}_{\chi,0}$, where $\Pi_{\chi,\aff}\subset\Phi_{\chi,\aff}$ is a set of minimal affine roots. Moreover, $W_\chi^\circ$ acts simply transitively on the set of Weyl chambers of $\Phi_\chi$ and $W_{\chi,\aff}$ acts simply transitively on the set of alcoves of $\Phi_\chi$. Finally, $\tilde{W}_\chi$ also decomposes as a semi-direct product $W_{\chi,\aff}\rtimes\Omega_\chi$, where %$\Omega_\chi=\mathrm{Stab}_{\tilde{W}_\chi}(\mathcal{D}_{\chi,0})$
    $$\Omega_\chi=\{w\in\tilde{W}_\chi\ |\ w\mathcal{D}_{\chi,0}=\mathcal{D}_{\chi,0}\}.$$
    Finally, the length function of $W_{\chi,\aff}$ as a coxeter group agrees with that of $W_\chi$ and can be extended uniquely to a function $l_\chi:\tilde{W}_\chi\rightarrow\ZZ^{\geq0}$ such that $\Omega_\chi=\{w\in\tilde{W}_\chi\ |\ l_\chi(w)=0\}$. In fact, $l_\chi(w)$ is the number of affine hyperplanes of $\Phi_\chi$ separating $\mathcal{D}_{\chi,0}$ to $w\cdot\mathcal{D}_{\chi,0}$.

    \begin{lemma}
        We have that $W_\chi^\circ\subseteq W_\chi$ and $W_{\chi,\aff}\subseteq \tilde{W}_\chi$. If $G=\mathrm{GL}_n$, then $W_\chi^\circ= W_\chi$
    \end{lemma}
    \begin{proof}
        For the first part, it is enough to prove that if $\alpha\in\Phi_\chi$, then $\prescript{s_\alpha}{}{\chi}=\chi$. For this, we note that $T(\cO)$ is an abelian group generated by the elements $\{\cbeta(\lambda)|\beta\in\Phi,\lambda\in\cO^\times\}$. Since 
        $$s_\alpha^{-1}\cbeta(\lambda)s_\alpha\cbeta(\lambda)^{-1}=\check{s_\alpha(\beta)}(\lambda)\check{\beta}(\lambda)^{-1}=s_{\calpha}(\cbeta)(\lambda)\cbeta(\lambda)^{-1}=\cbeta(\lambda)\calpha(\lambda^{-\langle\alpha,\cbeta\rangle})\cbeta(\lambda)=\calpha(\lambda^{-\langle\alpha,\cbeta\rangle}),$$
        it follows that $\prescript{s_\alpha}{}{\chi}(\cbeta(\lambda))=\chi(\cbeta(\lambda))$ for all $\beta\in\Phi$ and $\lambda\in\cO^\times$ and therefore $\prescript{s_\alpha}{}{\chi}=\chi$ as required.

        If $G=\mathrm{GL}_n$, then $\chi=\chi_1\otimes\cdots\otimes\chi_n$ where each $\chi_i$ is the inflation of a character of $k_F^\times$ to $\cO^\times$ trivial on $1+\varpi\cO$. Moreover, $W$ acts by conjugation on $T(F)$ and permutes the $n$ diagonal entries. One can easily see that $W=S_n$ and that the reflections $\{s_\alpha, \alpha\in\Phi^+\}$ correspond to transpositions $\tau_\alpha$ in $S_n$ in a canonical way. Moreover, if $\tau_\alpha,\alpha\in\Phi^+$ permutes the $i$-th and $j$-th diagonal entries with $i<j$, then $\calpha(\lambda)$ is a diagonal matrix with 
        $$\calpha(\lambda)_{k,k}=\begin{cases}
            \lambda &\text{ if } k=i,\\
            \lambda^{-1} &\text{ if } k=j,\\
            1 &\text{ otherwise.}
        \end{cases}$$
        
        Therefore, $\tau_\alpha\in W_\chi$ if and only if $\chi_i=\chi_j$, which is equivalent to $\chi(\calpha(\lambda))=1$ for all $\lambda\in\cO^\times$. If $\sigma\in W=S_n$ is an arbitrary element, then one can easily see that $\sigma\in W_\chi$ if and only if $\chi_i=\chi_{\sigma(i)}$ for each $i=1,\ldots,n$. Thus, if we express $\sigma$ as a product of disjoint cycles, then $\sigma\in W_\chi$ if and only if all the cycles also lie in $W_\chi$, so we may assume that $\sigma$ is a cycle itself. Then we can express $\sigma$ as a product of transposition, all of which permute elements not fixed by $\sigma$. If $\sigma\in W_\chi$, then $\chi_i=\chi_{\sigma(i)}$ and each transposition lies in $W_\chi$ too and thus in $W_\chi^\circ$ by the above argument. This immediately implies that $\sigma\in W_\chi^\circ$ as desired. 
    \end{proof}

    We remark that the latter part of the Lemma breaks down even for $G=\mathrm{SL}_n$. It is still true that $W=S_n$ and that a transposition lies in $W_\chi$ if and only if it lies in $W_\chi^\times$, but it can now happen for a cycle to lie in $W_\chi$ which is not a product of transpositions in $W_\chi^\circ$. Explicitly, if $G=\mathrm{SL}_n$ with $n\geq3$ and $n\mid q-1$, then one can choose a character $\chi_1$ of $k_F^\times$ inflated to $\cO^\times$ of order $n$. Then the character 
    $$\chi(a_1,\ldots,a_n)=\chi_1(a_1)\chi_1^2(a_2)\cdots\chi_1^n(a_n)$$
    satisfies that $W_\chi^\circ=\{1\}$ but the cycle $(12\cdots n)\in W_\chi$ since $a_1\cdots a_n=1$.

    If $G=\mathrm{Sp}_4$ for example, the situation is even worse. Let $\chi=\chi_1\otimes\chi_2$ be a character of the torus, where 
    \begin{equation}
        \chi\left(\begin{smallmatrix}
            s&&&\\
            &t&&\\
            &&s^{-1}&\\
            &&&t^{-1}
        \end{smallmatrix}\right)=\chi_1(s)\chi_2(t).
    \end{equation}
    If $\chi_1=\chi_2=\textrm{sgn}$, then $W_\chi=W$ but $\Phi_\chi$ only contains the short roots, and therefore $W_\chi^\circ\cong C_2\times C_2$ regardless of $q$.

    \begin{lemma}
        If $W_\chi^\circ=W_\chi$, then $\tilde{W}_\chi$ is the extended Weyl group associated to $\Phi_\chi$. 
    \end{lemma}

    Before we state the main theorem, we first need to define the Hecke algebra $\cH(W,S,q_S)$ associated to a coxeter pair $(W,S)$ and a parameter set $q_S:S\rightarrow\QQ^{\geq0}$. This is a $\CC$-algebra with basis $\{T_w:w\in W\}$ and relations
    \begin{align*}
        T_{w_1w_2}&=T_{w_1}T_{w_2}, \ \quad\quad\quad\quad\quad\quad\text{ if } l(w_1w_2)=l(w_1)+l(w_2),\\
        T_s^2&=(q_s-1)T_s+qT-1,\quad \text{ if } s\in S.
    \end{align*}

    \begin{definition}
        Let $\chi$ be a depth-zero character of $T(\cO)$. Then we define 
        $$\cH_\chi:=\cH(W_{\chi,\aff},S_{\chi,\aff},q)\tilde\otimes\CC[\Omega_\chi],$$ 
        where the twisted tensor product is the usual tensor product in the underlying vector spaces, but where multiplication is given by 
        $$(T_{w_1}\otimes e_{\sigma_1})(T_{w_2}\otimes e_{\sigma_2})=T_{w_1}T_{\sigma_1w_2\sigma_1^{-1}}\otimes e_{\sigma_1\sigma_2}$$
    \end{definition}
    We are now ready to state the main theorem. To state it, we fix an extension $\check{\chi}:N(F)\rightarrow\CC^\times$ of $\chi$ and we choose a section $\tilde{W}_\chi\rightarrow N_\chi$, $w\mapsto n_w$ such that $n_{w_1w_2}=n_{w_1}n_{w_2}$, which they both exist. We abuse notation and write $[IwI]_{\check{\chi}}\in\cH(G,I,\rho_\chi)$ for the function supported on $In_wI$ and having value $\check{\chi}(n_w)$ on $n_w$. Since the double cosset $In_wI$ is independent of the lift, we shall simply write $IwI$. However, we remark that the function $[IwI]_{\check{\chi}}$ does depend on the lift $n_w$.
    \begin{theorem}
        Let $\chi$ be a character of $T(\cO)$ and let $\check{\chi}:N(F)\rightarrow\CC^\times$ be an extension of $\chi$. Then there is a support-preserving algebra isomorphism 
        $$\cH(G,I,\rho_\chi)\longrightarrow\cH_\chi$$
        such that for all $w\in \tilde{W}_\chi$ with $w=w'\sigma$, $w'\in W_{\chi,\aff}, \sigma\in\Omega_\chi$,
        it sends $q^{-l(w)/2}[IwI]_{\check{\chi}}$ to $q^{-l_\chi(w)/2}(T_{w'}\otimes e_\sigma)$.
    \end{theorem}

    To prove the theorem, the first observation is that the support of $\cH(G,I,\rho_\chi)$ is the intertwiner set $$\mathrm{Supp}\cH(G,I,\rho_\chi)=I_G(\rho_\chi)=IN_\chi I=\bigsqcup_{w\in\tilde{W}_\chi}IwI$$ and that therefore $\{[IwI]_{\check{\chi}}\ |\ w\in\tilde{W}_\chi\}$ is a $\CC$-basis for $\cH(G,I,\rho_\chi)$.

    Secondly, we may define, for each $w\in\tilde{W}_\chi$, the element
    $$\varphi_w:=q^{(l_\chi(w)-l(w))/2}[IwI]_{\check{\chi}},$$
    corresponding to $T_{w'}\otimes e_\sigma$ under the isomorphism. Then the proof of the theorem is a direct consequence of the following result.

    \begin{proposition}
        The elements $\varphi_w, w\in\tilde{W}_\chi$ satisfy the following relations:
        \begin{enumerate}
            \item (Additive relations) $\varphi_{w_1w_2}=\varphi_{w_1}*\varphi_{w_2},$ if $l_\chi(w_1w_2)=l_\chi(w_1)+l_\chi(w_2)$.
            \item (Quadratic relations) $\varphi_s^2=(q-1)\varphi_s+q\varphi_1,$ if $s\in S_{\chi,\aff}$. 
        \end{enumerate} 
    \end{proposition}
    